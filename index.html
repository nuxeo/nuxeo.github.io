<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

	<!-- Basic Page Needs
  ================================================== -->
	<meta charset="utf-8">
	<title>Nuxeo</title>
	<meta name="description" content="Nuxeo on Github">
	<meta name="author" content="nuxeo">

	<!-- Mobile Specific Metas
  ================================================== -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS
  ================================================== -->
	<link rel="stylesheet" href="stylesheets/base.css">
	<link rel="stylesheet" href="stylesheets/skeleton.css">
	<link rel="stylesheet" href="stylesheets/layout.css">

	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

<link href='http://fonts.googleapis.com/css?family=PT+Sans+Caption:400,700' rel='stylesheet' type='text/css'>

<style>
#xnav-footer {margin-top:0px !important;}
</style>
<script src="javascripts/jquery-1.7.1.min.js"></script>
<script src="jsonpath-0.8.0.js"></script>
<script type="text/javascript" src="http://www.nuxeo.com/extension/nuxeo_design/design/nuxeo/javascript/xnav_confluence_get.js" charset="utf-8"></script>
	<!-- Favicons
	================================================== -->
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

</head>
<body>



	<!-- Primary Page Layout
	================================================== -->


<div class="container">
  <div class="sixteen columns">
     <h1 class="remove-bottom" id="site-title" style="margin-top: 40px">nuxeo<span class="separator">/</span><span class="nxsexion">Sources</span></h1>
  </div>
  <div id="welcome">
  <div class="twelve columns message">
     <h2>Welcome to the Nuxeo Sources github repository</h2>
      <p>If you're a Nuxeo developer, this is the place for you. This page features the list of platform modules, addons and community projects available on GitHub. We hope you'll find what you're lookin' for and are wating for your pull requests!</p>
  </div>
  <div class="four columns numbers">
    <div id="repo-stats" >
     <h5 class="members"><span id="membersCountLoading"><img src="./images/loading.gif" /></span><a href="https://github.com/nuxeo"><span id="num-members">&nbsp;</span> members</a></h5>
     <h5 class="repositories"><span id="repoCountLoading"><img src="./images/loading.gif" /></span><a href="https://github.com/nuxeo"><span id="num-total-repos">&nbsp;</span> repositories</a></h5>
    </div>
  </div>
  <div style="clear:both;"></div>
</div>
  <div class="sixteen columns personal">
    <h3>Participants</h3>
    <div id="participant-list">
      <span id="membersLoading"><img src="./images/loading.gif" /></span>
    </div>
  </div>


  <div>
  <div class="ten columns nuxeo">
    <h3>Nuxeo Projects</h3>
<div>
    <h4>Nuxeo Platform</h4>
<p class="chapo">This is the list of platform modules constituting the basis of Nuxeo Platform. </p>
<div id="nxPlatformContainer">
<span id="platformLoading"><img src="./images/loading.gif" /></span>
</div>
</div>

<div>
    <h4>Addons</h4>
<p class="chapo">Here's the list of all the addon hosted on Github by Nuxeo's team. </p>

<div id="nxAddonContainer">
</div>

<div class="toggle"><a id="addonToggle">[ Show more ]</a><span id="addonLoading"><img src="./images/loading.gif" /></span></div>

</div>

  </div>

  <div id="communityProjects" class="six columns community">
    <h3>Community Projects</h3>
<p class="chapo">Take a look at all the community project. If your project is missing, send us a mail, or even better a pull request on this <a href="https://github.com/nuxeo/nuxeo.github.com/blob/master/repositories.json">file</a> :)  </p>
<div id="cmProjectContainer" >

</div>
<div class="toggle"><a id="cmToggle">[ Show more ]</a><span id="cmLoading"><img src="./images/loading.gif" /></span></div>
  </div>

</div>
<!-- container -->

	<!-- JS
	================================================== -->
    <script src="javascripts/strftime.js"></script>
    <script src="javascripts/tabs.js"></script>

    <script type="text/javascript">
    (function ($, undefined) {

        // Put community repositories json description
        var communityRepos;

        // Put platform repositories json description
        var platformRepos;

        // Put personal repositories json description
        var personalRepos;

        // Put personal repositories json description
        var timelineRepos;

        // Put custom repo URL's in this object, keyed by repo name.
        var customRepoUrls;

        // Put custom repo descriptions in this object, keyed by repo name.
        var customRepoDescriptions;

        var defaultRepoCategories;

        var commits = new Array();

        var cmProjectIdx = 0;

        var alreadyloading = false;

        $.getJSON("./repositories.json", function(data) {
            $("#addonLoading").hide();
            $("#repoCountLoading").hide();
            $("#membersLoading").hide();
            $("membersCountLoading").hide();
            $("#platformLoading").hide();
            $("#cmLoading").hide();
            communityRepos = data.community;
            platformRepos = data.platform;
            personalRepos = data.personal;
            timelineRepos = data.timeline;
            customRepoDescriptions = data.customRepoDescriptions;
            customRepoUrls= data.customRepoUrls;
            defaultRepoCategories = data.defaultRepoCategories;
            addOrgaMembers();
            addRepoCount();
            addThreeCommunityRepo();
            addPlatformRepo();
            nextAddonPage();
            $('#cmToggle').click(addThreeCommunityRepo);
            $('#addonToggle').click(nextAddonPage);
        });

 
        $(window).scroll(function() {
           if ($('body').height() <= ($(window).height() + $(window).scrollTop())) {
             if (alreadyloading == false) {
               alreadyloading = true;
               nextAddonPage();
               alreadyloading = false;
             }
           }
        });

        function repoUrl(repo) {
            return customRepoUrls[repo.name] || repo.html_url || repo.url ;
        }

        function repoDescription(repo) {
            return customRepoDescriptions[repo.name] || repo.description;
        }

        function addProject(repo, targetId) {
            var $projectContainer = $("<div>").attr("class","project");
            var $title = $("<h5>").appendTo($projectContainer);
            var $link = $("<a>").attr("href", repo.html_url).text(repo.name).appendTo($title);
            if (repo.language) {
                var $byline = $("<div>").attr("class", "byline").text(repo.language + " " + repo.watchers).appendTo($projectContainer);
            }
            var $description = $("<p>").text(repoDescription(repo)).appendTo($projectContainer);
            $projectContainer.appendTo(targetId);
        }

        function addCMProject(repo) {
            var $projectContainer = $("<div>").attr("class","project");
            var $title = $("<h5>").appendTo($projectContainer);
            var $link = $("<a>").attr("href", repo.html_url).text(repo.name).appendTo($title);
            var $orgaSpan = $("<span>").attr("class", "orga").text(" by " ).appendTo($title);
            var $orgaLink = $("<a>").attr("href", "https://github.com/" + repo.owner.login).text(repo.owner.login).appendTo($orgaSpan);
            var $byline = $("<div>").attr("class", "byline").text(repo.language + " " + repo.watchers).appendTo($projectContainer);
            var $description = $("<p>").text(repoDescription(repo)).appendTo($projectContainer);
            $projectContainer.appendTo("#cmProjectContainer");
        }

        function addPlatformRepo() {
            $("#platformLoading").show();
            $.each(platformRepos, function (i, repo) {
            var repoURL = formatNuxeoRepoUrl(repo);
            $.getJSON(repoURL, function(result) {
                addProject(result.data, "#nxPlatformContainer");
            });
            $("#platformLoading").hide();
            });
        }

        function addCommunityRepo() {
            if (communityRepos.length == cmProjectIdx) {
                $('#cmToggle').remove();
                return;
            }
            var repo = communityRepos[cmProjectIdx];
            cmProjectIdx++;
            var repoURL = formatRepoUrl(repo);
            $("#cmLoading").show();
            $.getJSON(repoURL, function(result) {
                addCMProject(result.data);
            $("#cmLoading").hide();
            });
        }

        function addThreeCommunityRepo() {
            for (i=1; i<=3; i++) {
                addCommunityRepo();
            }
        }

        function formatRepoUrl(repo, page) {
            return "https://api.github.com/repos/"+
                    repo.owner  +"/" + repo.projectName+"?callback=?&";
        }

        function formatNuxeoRepoUrl(repo, page) {
            return "https://api.github.com/repos/nuxeo/" + repo + "?callback=?&";
        }

        function formatRepoCollaborator(owner, name) {
            return "https://api.github.com/repos/"+
                    owner  +"/" + name + "/collaborators?callback=?"
        }

        function formatOrgRepoUrl(page) {
            var url = "https://api.github.com/orgs/nuxeo/repos?callback=?&";
            if (page) {
               return url + "&page="+page;
            } else {
               return url;
            }
        }

        function addOrgaMembers() {
        $("#membersLoading").show();
        $("#membersCountLoading").show();
        $.getJSON("https://api.github.com/orgs/nuxeo/members?callback=?", function (result) {
            var members = result.data;
            $(function () {
                $("#num-members").text(members.length);
                $.each(members, function (i, member) {
                  var $item = $("<div>");
                  var $link = $("<a>").attr("href", "https://github.com/" + member.login).appendTo($item);
                  var $image = $("<img>").attr("src", member.avatar_url).attr("alt", member.login).appendTo($link);
                  $item.appendTo("#participant-list");
                });
            });
        $("#membersLoading").hide();
        $("#membersCountLoading").hide();
        });
        }

        function addRepoCount() {
        $("#repoCountLoading").show();
        $.getJSON("https://api.github.com/orgs/nuxeo?callback=?", function (result) {
            var orga = result.data;
            $(function () {
                var totalRepositories = orga.public_repos + communityRepos.length;
                $("#num-total-repos").text(totalRepositories);
            });
        $("#repoCountLoading").hide();
        });
        }

        var pageCount = 1;
        var lastPageUrl;
        function nextAddonPage() {
        $("#addonLoading").show();
        $.getJSON(formatOrgRepoUrl(pageCount), function (result) {
            $(function () {
                var repos = result.data;
                $.each(repos, function (i, repo) {
                      if (platformRepos.indexOf(repo.name) == -1) {
                        addProject(repo, "#nxAddonContainer");
                    }
                });
                if (!lastPageUrl) {
                    var links = result.meta.Link;
                    $.each(links, function (i, link) {
                     if (link[1].rel == 'last') {
                        lastPageUrl = link[0];
                     }
                    });
               }
               if (lastPageUrl && lastPageUrl.match(pageCount+"$")) {
                  $('#addonToggle').remove();
                  $(window).unbind('scroll');
               }
               pageCount++;
            });
        $("#addonLoading").hide();
        });
        }

    })(jQuery);
    </script>

<!-- End Document
================================================== -->
</body>
</html>
